<!doctype html><html lang=ru-ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Алексей Жидков"><meta name=description content="https://azhidkov.pro/"><meta property="og:site_name" content="Алексей Жидков"><meta property="og:title" content="Спецификация диаграммы эффектов v0.0.2 - Алексей Жидков"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://azhidkov.pro/effects-diagram/specification-html/"><meta property="og:image" content="https://azhidkov.pro/"><meta name=twitter:card content="summary"><meta name=twitter:site content="https://azhidkov.pro/effects-diagram/specification-html/"><meta name=twitter:image content="https://azhidkov.pro/"><base href=https://azhidkov.pro/effects-diagram/specification-html/><title>Спецификация диаграммы эффектов v0.0.2 - Алексей Жидков</title><link rel=canonical href=https://azhidkov.pro/effects-diagram/specification-html/><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700"><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css><link rel=stylesheet href=https://azhidkov.pro/css/custom.css><link rel=stylesheet href=https://azhidkov.pro/css/github.css><link rel=stylesheet href=https://azhidkov.pro/css/JetBrains-Mono.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=alternate href=https://azhidkov.pro/index.xml type=application/rss+xml title="Алексей Жидков"><link href=https://azhidkov.pro/index.xml rel=feed type=application/rss+xml title="Алексей Жидков"><meta name=generator content="Hugo 0.80.0"></head><body><main class=wrapper><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://azhidkov.pro/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://azhidkov.pro/favicon-16x16.png><link rel=manifest href=site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet type=text/css><nav class=navigation><section class=container style=height:100%><img src=https://azhidkov.pro/images/logo.svg class=logo>
<a class=navigation-title href=/>Алексей Жидков</a>
<input type=checkbox id=menu-control>
<label class="menu-mobile float-right" for=menu-control><span class="btn-mobile float-right">&#9776;</span><ul class=navigation-list><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/book/ergo>Книга</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/posts>Блог</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/portfolio>Портфолио</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/>Контакты</a></li><li class=mobile-menu-lang-separator-full><hr></li><li class=multilingual-separator><p>|</p></li><li class="navigation-item align-left"><a href=https://azhidkov.pro/en/>En</a></li></ul></label></section></nav><div class=content><section class="container page"><article><header><h1>Спецификация диаграммы эффектов v0.0.2</h1></header><section class="doc-section level-1"><h2 id=_история_изменений><a class=link href=#_история_изменений>История изменений</a></h2><section class="doc-section level-2"><h3 id=_v0_0_2><a class=link href=#_v0_0_2>v0.0.2</a></h3><div class="olist arabic"><ol class=arabic><li>Отказ от представления событий отдельными блоками</li><li>Переход на визуальный язык C4 Model</li></ol></div></section><section class="doc-section level-2"><h3 id=_v0_0_1><a class=link href=#_v0_0_1>v0.0.1</a></h3><div class="olist arabic"><ol class=arabic><li>Первая версия</li></ol></div></section></section><section class="doc-section level-1"><h2 id=_введение><a class=link href=#_введение>Введение</a></h2><p>Диаграмма Эффектов - это инструмент для разработчиков, созданный для визуализации поведения информационной системы через её эффекты.
Эффект - это взаимодействие системы с внешним миром (например, запись и чтение диска, обращение к БД, обращение к внешним сервисам и т.п.).</p><p>Такое представление полезно на всех этапах разработки ПО - от первичного анализа до планирования работ и поддержки.</p></section><section class="doc-section level-1"><h2 id=_концептуальная_модель><a class=link href=#_концептуальная_модель>Концептуальная модель</a></h2><p>В основе концептуальной модели диаграммы лежат <strong>эффекты</strong> - атомарные единицы взаимодействия системы с окружающим миром.
Группы эффектов, которые обеспечивают атомарные функции системы, объединяются в <strong>операции</strong>.
Элементы окружающего мира, с которыми могут взаимодействовать операции, представлены внутри системы <strong>ресурсами</strong>.
Наконец, выполнение операций инициируется <strong>событиями</strong>.</p><section class="doc-section level-2"><h3 id=_эффект><a class=link href=#_эффект>Эффект</a></h3><p>Эффект - это акт чтения или изменения некоторого изменяемого состояния.
Это может быть состояние внешнего устройства, доступное через операции ввода-вывода, или глобальная память программы, доступная напрямую.</p><p>Эффекты чтения характеризуются тем, что считывание одного и того же состояния в разные моменты времени может дать разные результаты.
А эффекты изменения (или записи) характеризуются тем, что изменённое состояние можно наблюдать за пределами текущего потока исполнения.</p><p>Примерами эффектов являются:</p><div class="olist arabic"><ol class=arabic><li>чтение и запись статической переменной</li><li>чтение и запись файла</li><li>выборка или обновление данных в таблице реляционной БД</li><li>отправка HTTP GET и POST запросов</li></ol></div><p>Понятие эффекта подробнее рассмотрено в <a href=#_приложение_3_философия_эффекта>Приложении 3</a> этого документа.</p></section><section class="doc-section level-2"><h3 id=_операция><a class=link href=#_операция>Операция</a></h3><p>Как правило, для реализации функции системы требуется несколько эффектов.
Как минимум что-то считать и потом записать обратно.
Группы эффектов, реализующих одну функцию системы, образуют операции системы.</p></section><section class="doc-section level-2"><h3 id=_ресурс><a class=link href=#_ресурс>Ресурс</a></h3><p>У эффектов, которые являются действиями, есть объект - целевое состояние.
Это некоторая часть физического мира, с которой будет взаимодействовать устройство ввода-вывода в процессе реализации эффекта.
Чаще всего целевым состоянием выступают биты на носителях информации, но это могут быть и пиксели экрана, и динамик колонки и актуатор робота.
Эти части физического мира представлены в системе ресурсами.</p></section><section class="doc-section level-2"><h3 id=_событие><a class=link href=#_событие>Событие</a></h3><p>Программа выполняет набор эффектов в ответ на событие.
Таким событием может быть получение вызова удалённой процедуры в любом виде, появление нового сообщения в очереди сообщений, наступление определённого момента времени и т.д.</p><p>Система может реагировать как несколькими операциями (выполнять несколько функций) в ответ на одно событие, так и одной операцией в ответ на несколько событий разных типов.</p></section></section><section class="doc-section level-1"><h2 id=_применение><a class=link href=#_применение>Применение</a></h2><p>Чёткое понимание операций системы (когда они выполняются и к каким эффектам приводят) является критически важным на всех этапах жизненного цикла разработки системы.</p><p>На этапе старта проекта по развитию существующей системы, эффекты помогают понять текущее наблюдаемое поведение, а сцепленность операций через ресурсы помогает спрогнозировать последствия планируемых изменений.
Вместе это помогает предотвратить внесение регрессий, в виде нежелательных изменений в наблюдаемом поведении.</p><p>На этапе анализа Диаграмма Эффектов помогает переформулировать требования в абстракциях будущей программы.</p><p>(<mark>todo: ревью</mark>)
На этапе оценки требования, сформулированные в терминах абстракций будущей программы, помогают понять что необходимо сделать (список операций) и насколько сложно это сделать (список событий, требуемых эффектов и целевых ресурсов).</p><p>На этапе проектирования операции и ресурсы становятся ключевыми блоками, правильная декомпозиция которых создаст основу для системы с низкой сцепленностью.</p><p>На этапе реализации сложность операций (определяемая количеством и типом обеспечивающих её ресурсов) и их зависимость через ресурсы помогают определить порядок выполнения работ и те работы, которые могут быть выполнены параллельно.</p></section><section class="doc-section level-1"><h2 id=_нотация><a class=link href=#_нотация>Нотация</a></h2><p>В основе визуального языка Диаграммы Эффектов лежит язык <a href=https://c4model.com/>модели C4</a>.
С одной стороны, это позволяет встраивать Диаграмму эффектов в модель C4 на четвёртом уровне - вместо кода.</p><p>Диаграмма Эффектов бывает двух типов - краткая и полная.
Краткая содержит только обозначение эффектов и связанных ими операций и ресурсов.
Полная нотация дополнительно включает события и их источники, внешние системы, обеспечивающие реализацию ресурсов и более полное описание всех элементов.</p><p>Нотации рассматриваются с помощью минимального примера визуализации функциональности регистрации и аутентификации пользователей в произвольной системе.
После успешной регистрации пользователям отправляется приветственное письмо.</p><section class="doc-section level-2"><h3 id=_краткая_нотация><a class=link href=#_краткая_нотация>Краткая нотация</a></h3><p>В краткой нотации диаграмма выглядит следующим образом (картинка кликабельна):</p><div class=image-block><a class="image bare" href=/effects-diagram/images/spec/short-notation-example.png title="Open the image in full size" aria-label="Open the image in full size"><img src=/effects-diagram/images/spec/short-notation-example.png alt="short notation example"></a></div><p>Теперь рассмотрим отдельные элементы</p><section class="doc-section level-3"><h4 id=_операции><a class=link href=#_операции>Операции</a></h4><p>Операции обозначаются прямоугольником с именем операции:</p><div class=image-block><img src=/effects-diagram/images/spec/operation.png alt=operation></div></section><section class="doc-section level-3"><h4 id=_ресурсы><a class=link href=#_ресурсы>Ресурсы</a></h4><p>Ресурсы обозначаются прямоугольником с именем ресурса и цветом, отличным от цвета операции:</p><div class=image-block><img src=/effects-diagram/images/spec/resource.png alt=resource></div></section><section class="doc-section level-3"><h4 id=_эффекты><a class=link href=#_эффекты>Эффекты</a></h4><p>Эффект модификации ресурса обозначается "сильной" (более заметной) стрелкой от операции к ресурсу, с кратким описанием эффекта:</p><div class=image-block><img src=/effects-diagram/images/spec/operation-resource-rw.png alt="operation resource rw"></div><p>Эффект чтения ресурса обозначается стрелкой от ресурса к операции, с кратким описанием считываемых данных:</p><div class=image-block><img src=/effects-diagram/images/spec/operation-resource-ro.png alt="operation resource ro"></div></section><section class="doc-section level-3"><h4 id=_эффекты_косвенного_вызова_операций><a class=link href=#_эффекты_косвенного_вызова_операций>Эффекты косвенного вызова операций</a></h4><p>Для эффектов косвенного вызова операций вследствие взаимодействия с ресурсами определён особый вид стрелок.
Как правило, эти эффекты реализуются через ресурсы всевозможных шин событий и связанные с ними операции-обработчики.
Такие связи отображаются прерывистой стрелкой того же стиля, что и стрелка эффекта записи с кратким описанием связи:</p><div class=image-block><img src=/effects-diagram/images/spec/resource-operation-rw.png alt="resource operation rw"></div></section><section class="doc-section level-3"><h4 id=_примечания><a class=link href=#_примечания>Примечания</a></h4><p>На диаграмму можно помещать заметки и примечания, используя любую удобную нотацию.
Рекомендуемой нотацией примечаний явлется "лист" с загнутым углом, связанный прерывистой линией с комментируемым элементом.</p><div class=image-block><img src=/effects-diagram/images/spec/note.png alt=note></div><p>Это все элементы, составляющие ядро Диаграммы Эффектов.</p></section></section><section class="doc-section level-2"><h3 id=_полная_нотация><a class=link href=#_полная_нотация>Полная нотация</a></h3><p>Теперь рассмотрим ту же функциональность, описанную в полной нотации:</p><div class=image-block><a class="image bare" href=/effects-diagram/images/spec/full-notation-example.png title="Open the image in full size" aria-label="Open the image in full size"><img src=/effects-diagram/images/spec/full-notation-example.png alt="full notation example"></a></div><p>В полной нотации появляются:</p><div class="olist arabic"><ol class=arabic><li>события</li><li>описание операций и ресурсов в формате модели C4</li><li>границы контейнера из C4.
Обозначает границы процесса - всё, что находится внутри этих границ выполняется в памяти визуализируемого приложения</li><li>внешние системы, базы данных и компоненты из C4.
Внешние системы могут быть как источником события, так и средством реализации ресурса</li></ol></div><p>Расширять состав диаграммы можно постепенно, добавляя только те элементы, которые помогают в решении текущей задачи.</p><section class="doc-section level-3"><h4 id=_события><a class=link href=#_события>События</a></h4><p>В полной нотации события обозначаются стрелкой от внешней системы к операции с кругом на стартовом конце и описанием в формате C4.
Но в промежуточной версии, внешнюю систему можно опустить и "подвесить" стрелку:</p><div class=image-block><img src=/effects-diagram/images/spec/event-operation.png alt="event operation"></div></section><section class="doc-section level-3"><h4 id=_описания><a class=link href=#_описания>Описания</a></h4><p>Блоки операций и ресурсов можно дополнить типом, способом реализации и описанием:</p><div class=image-block><img src=/effects-diagram/images/spec/descriptions.png alt=descriptions></div></section><section class="doc-section level-3"><h4 id=_внешние_системы><a class=link href=#_внешние_системы>Внешние системы</a></h4><p>Элементы, обозначающие границы системы и внешние системы полностью соответствуют нотации C4:</p><div class="olist arabic"><ol class=arabic><li>Границы системы отображаются прерывистым прямоугольником приглушённого цвета и подписью с именем контейнера</li><li>Управляемые внешние системы и базы данных обозначаются прямоугольником и символом "База Данных"</li><li>Неуправляемые внешние системы и компоненты обозначаются приглушёнными прямоугольниками</li><li>Неуправляемые базы данных обозначаются приглушённым символом "База Данных"</li></ol></div><p>Внешние системы связываются с операциями посредством событий:</p><div class=image-block><img src=/effects-diagram/images/spec/event-sources.png alt="event sources"></div><p>Ресурсы связываются с внешними системами посредством стрелок с описанием:</p><div class=image-block><img src=/effects-diagram/images/spec/resource-impls.png alt="resource impls"></div><p>Ресурс может быть связан со сторонним компонентом, работающем в том же процессе:</p><div class=image-block><img src=/effects-diagram/images/spec/resource-component.png alt="resource component"></div><p>Здесь приведена связь ресурса с эффектом вызова операции системы.
В случае же если ресурс не обладает таким эффектом, то он соединяется со сторонним компонентом обычной стрелкой.</p><hr><p>Выбор нотации зависит от решаемой задачи.
Если требуется быстро разбить систему на модули, или спланировать модификацию сложной или незнакомой операции - можно обойтись краткой нотацией.
Если требуется оценить проект для работы за фиксированную цену - лучше использовать полную нотацию, чтобы минимизировать вероятность "потери" существенных деталей.</p><p>Ещё два критерия выбора нотации - срок жизни диаграммы и размер целевой аудитории диаграммы.
Если планируемые срок жизни и аудитория диаграммы ограничиваются временем построения/анализа и автором, то можно использовать краткую нотацию.
Если же планируется использование диаграммы спустя длительный срок после создания или публикация Диаграммы для ознакомления без руководства автора - по меньшей мере стоит добавить события и описания ресурсов и операций.</p></section></section></section><section class="doc-section level-1"><h2 id=_приложение_1_инструментарий><a class=link href=#_приложение_1_инструментарий>Приложение 1. Инструментарий</a></h2><p>Благодаря базированию на визуальном языке модели C4, для построения Диаграммы эффектов можно использовать <a href=https://c4model.com/#Tooling>любой инструмент с поддержкой C4</a>.</p></section><section class="doc-section level-1"><h2 id=_приложение_2_реализация_концептуальной_модели_в_коде><a class=link href=#_приложение_2_реализация_концептуальной_модели_в_коде>Приложение 2. Реализация концептуальной модели в коде</a></h2><p>Все элементы, описанные в концептуальной модели, транслируются непосредственно в код: события и операции - в методы, ресурсы - в классы, эффекты - в вызовы методов.</p><p>Операции всегда транслируются в методы классов слоя сервисов приложения - методы, определяющие публичный интерфейс модуля.
При реализации этих методов желательно сохранить очевидность эффектов выполнения операции, присущую диаграмме - методы должны содержать в себе столько же вызовов "эффективных" методов, сколько стрелок у соответсвующей операции на диаграмме.</p><p>Ресурсы превращаются в структуру данных и коллекцию методов работы с ней - классы Spring Data агрегата и репозитория, классы события и ApplicationEventPublisher-а (или обёртки вокруг него), классы REST API модели и клиента и т.п.
В контексте бэкэндов информационных систем, самыми распространёнными видами ресурсов являются:</p><div class="olist arabic"><ol class=arabic><li>любые постоянные коллекции данных - таблицы в реляционной СУБД, коллекции в документной СУБД и т.д.</li><li>REST API внешних сервисов</li><li>любые очереди сообщений/шины событий</li><li>изменяемые структуры данных, доступные через глобальные переменные</li></ol></div><p>События превращаются в методы, передаваемые фреймворку для последующего вызова - метод Spring-ового RestController-а, Swing-овый EventListener, реализация Runnable для таймера и т.д.
Если говорить о бакэндах информационных систем, то самыми распространёнными видами событий являются:</p><div class="olist arabic"><ol class=arabic><li>Получение запроса по сети (@RestController + @*Mapping в случае разработки на Spring).
Сейчас популярностью пользуется протокол запросов в REST-стиле, но SOAP, gRPC, CORBA и т.п. так же попадают в эту категорию.</li><li>Появление сообщения в очереди (@JmsListener).</li><li>Доменное событие или событие приложения (@EventListener)</li><li>Наступление определённого момента времени (@Scheduled).
Два основных типа таких событий:<ol class=loweralpha type=a><li>наступление заранее известного момента времени (например, полуночи вторника)</li><li>истечение определённого времени с момента в прошлом (например, истечение суток с момента создания предыдущего бэкапа).</li></ol></li></ol></div></section><section class="doc-section level-1"><h2 id=_приложение_3_философия_эффекта><a class=link href=#_приложение_3_философия_эффекта>Приложение 3. Философия эффекта</a></h2><p>Эффект в программировании это всегда <strong>действие</strong> по изменению состояния какого-то транзистора.
В эффекте чтения состояние транзистора памяти внешнего устройства через несколько промежуточных этапов попадает в регистр процессора (который является группой транзисторов).</p><p>В эффекте записи, наоборот, состояние регистра процессора переносится в транзистор внешнего устройства.
На этом эффект может быть завершён, в случае жёсткого диска, либо это состояние может быть "аналогизировано" - превращено в физический процесс (например, световую волну или движение ноги робота).
Так эффект работы программы становится наблюдаемым поведением.</p><p>Вообще "неэффектов" не существует - любое действие в программе выражается в изменении состояния транзисторов.
В <a href=https://ru.wikipedia.org/wiki/%D0%90%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0_%D1%84%D0%BE%D0%BD_%D0%9D%D0%B5%D0%B9%D0%BC%D0%B0%D0%BD%D0%B0>фон Нейманавской архитектуре</a>, по крайней мере.</p><p>При этом существует функциональная парадигма программирования, которая характеризуется акцентом на функциях без эффектов.
Но в современном компьютере даже идеально чистая вызывающая функция записывает данные в память, выделенную для стэка, и ожидает, что идеально чистая вызываемая функция их считает, а потом запишет свой результат.</p><p>Я ни разу не встречал формального определения того, что считается эффектом, а что "неэффектом".
Но, по-видимому, общепринятое мнение таково, что изменение регистра процессора и стэка программы эффектами не считается, а любые изменения начиная с кучи программы и далее - считаются.
То есть разница между эффектом и "неэффектом" в области видимости.
Или, другими словами, в количестве наблюдателей поведения.</p><p>Высокоуровневый эффект может проходить через несколько этапов переноса, посредством чтения и записи.
Например, эффект "Отправить пуш уведомление" пройдёт такой путь: сначала информация переносится через кэши из процессора в память программы, потом в память ОС, потом в память сетевой карты, потом через память нескольких роутеров и серверов в память сетевой карты другого компьютера (смартфона), там обратно в память программы, а оттуда, опять же через несколько слоёв, в память экрана, где состояние транзистора "аналогизиурется" в свечение пикселей в "шторке" смартфона.
И где-то попутно этот эффект заодно осядет на транзисторах диска БД пуш-сервиса.</p></section></article></section></div></main><script src=/js/app.js></script></body></html>