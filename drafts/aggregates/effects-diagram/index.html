<!doctype html><html lang=ru-ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Алексей Жидков"><meta name=description content="https://azhidkov.pro/"><meta property="og:site_name" content="Алексей Жидков"><meta property="og:title" content="Черновик: Диаграмма Эффектов v0.0.1 - Алексей Жидков"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://azhidkov.pro/drafts/aggregates/effects-diagram/"><meta property="og:image" content="https://azhidkov.pro/"><meta name=twitter:card content="summary"><meta name=twitter:site content="https://azhidkov.pro/drafts/aggregates/effects-diagram/"><meta name=twitter:image content="https://azhidkov.pro/"><base href=https://azhidkov.pro/drafts/aggregates/effects-diagram/><title>Черновик: Диаграмма Эффектов v0.0.1 - Алексей Жидков</title><link rel=canonical href=https://azhidkov.pro/drafts/aggregates/effects-diagram/><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Mono:400,700"><link rel=stylesheet href=/css/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css><link rel=stylesheet href=https://azhidkov.pro/css/custom.css><link rel=stylesheet href=https://azhidkov.pro/css/github.css><link rel=stylesheet href=https://azhidkov.pro/css/JetBrains-Mono.css><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=alternate href=https://azhidkov.pro/index.xml type=application/rss+xml title="Алексей Жидков"><link href=https://azhidkov.pro/index.xml rel=feed type=application/rss+xml title="Алексей Жидков"><meta name=generator content="Hugo 0.80.0"></head><body><main class=wrapper><link rel=apple-touch-icon sizes=180x180 href=apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://azhidkov.pro/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://azhidkov.pro/favicon-16x16.png><link rel=manifest href=site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link href="https://fonts.googleapis.com/css?family=Roboto" rel=stylesheet type=text/css><nav class=navigation><section class=container style=height:100%><img src=https://azhidkov.pro/images/logo.svg class=logo>
<a class=navigation-title href=/>Алексей Жидков</a>
<input type=checkbox id=menu-control>
<label class="menu-mobile float-right" for=menu-control><span class="btn-mobile float-right">&#9776;</span><ul class=navigation-list><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/book/ergo>Книга</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/posts>Блог</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/portfolio>Портфолио</a></li><li class="navigation-item align-left"><a class=navigation-link href=https://azhidkov.pro/>Контакты</a></li><li class=mobile-menu-lang-separator-full><hr></li><li class=multilingual-separator><p>|</p></li><li class="navigation-item align-left"><a href=https://azhidkov.pro/en/>En</a></li></ul></label></section></nav><div class=content><section class="container page"><article><header><h1>Черновик: Диаграмма Эффектов v0.0.1</h1></header><section class="doc-section level-1"><h2 id=_введение>Введение</h2><p>Сейчас самым распространённым способом декомпозиции ПО является декомпозиция по техническим аспектам - сервисы, сущности, исключения и т.п.
И хотя огромное количество авторов - начиная с Константина и Парнаса в 70-ых, продолжая Эвансом и Мартином в 00-ых и заканчивая большим количеством менее известных инженеров сейчас - критикует такой способ декомпозиции, никто из них не даёт практической методики выполнения альтернативной декомпозиции.
Поэтому для себя и своих команд я разработал методику, заполняющую этот пробел - методику декомпозиции систем на базе эффектов.
В основе этой методики лежит диаграмма эффектов.</p></section><section class="doc-section level-1"><h2 id=_диаграмма_эффектов_v0_0_1>Диаграмма эффектов v0.0.1</h2><aside class="admonition-block note" role=note><h6 class="block-title label-only"><span class=title-label>Note:</span></h6><p>Пока что я придерживаюсь мнения, что диаграмма эффектов - это моё ноухау.
Я знаю как минимум один очень похожий подход, описанный в <a href=https://www.researchgate.net/publication/283566310_Improving_Design_Decomposition>Improving Design Decomposition</a> и <a href=https://www.researchgate.net/publication/326260296_Functional_Decomposition_for_Software_Architecture_Evolution>Functional Decomposition for Software Architecture Evolution</a>, но этот пост является первой попыткой описать мою версию диаграммы более-менее формально.
Поэтому в описании возможны неточности и пробелы, а детали могут меняться в будущем.</p></aside><p>Диаграмма эффектов помогает рассмотреть систему с точки зрения операций (ответсвенностей, поведения) системы.
Каждая операция характеризуется набором событий, приводящей к её исполнению и набором ресурсов, необходимых для её исполнения.
События и операции связаны вызовами (не важно, синхронными или асинхронными).
Операции и ресурсы связаны обращениями на чтение и запись.
При желании, вызовы так же можно разделить на команды и запросы.
Если операция содержит хоть одно обращение на запись, то все её вызовы являются командами, в противном случае - запросами.
Вот собственно и вся нотация - три вида блоков, связанных тремя-четырьмя (<mark>todo: четырьмя?</mark>) видами стрелок.</p><p>В v0.0.1, операция - это всегда метод в слое сервисов приложения.
А вот события и ресурсы бывают разные.</p><p>Если говорить о бакэндах информационных систем, то самыми распространёнными видами событий являются следующие:</p><div class="olist arabic"><ol class=arabic><li>Получение HTTP-запроса.
Это может быть как чистый HTTP-запрос, так и запрос по более высоко-уровневому протоколу вроде SOAP.</li><li>Получение сообщения по очереди событий.
Это может быть как и "внепроцессная" очередь, вроде ActiveMQ, так и "внутрипроцессная" очередь вроде Spring Application Event Publisher.</li><li>Наступление определённого момента времени.
Такие события так же бывают двух типов - наступление заранее известного момента времени (например, полуночи вторника) и истечение определённого времени с момента в прошлом (например, истечение суток с момента создания предыдущего бэкапа).</li></ol></div><p>В конечном итоге, источники событий исходят из прерываний процессора, поэтому в более широком контексте событиями является всё, что приводит к порождению прерывания: нажатие кнопки мыши, получение пакета по сети, завершение операции чтения с диска и т.п.</p><p>В коде же события превращаются в метод, передаваемый фреймворку для последующего вызова - метод Spring-ового RestController-а, Swing-овый EventListener, реализация Runnable для таймера.</p><p>Опять же в контексте бэкэндов информационных систем, самыми распространёнными видами ресурсов являются следующие:</p><div class="olist arabic"><ol class=arabic><li>Любые постоянные коллекции данных - таблицы в реляционной СУБД, коллекции в документной СУБД и т.д.
Реляционные (и любые нормализованные) базы данных дают довольно низкоуровневую картину, с которой не очень удобно работать, поэтому в качестве базовых блоков подобных ресурсов я предпочитаю использовать ДДД Агрегаты</li><li>РЕСТ АПИ внешних сервисов</li><li>Любые очереди сообщений/шины данных</li><li>Коллекции файлов на диске</li><li>Глобальные изменяемые структуры данных</li></ol></div><p>Иногда (в контексте информационных систем) встречается обособленный вид ресурсов - сложный алгоритм, представленный чистой функцией.
От остальных ресурсов он отличается отсутствием состояния.</p><p>В коде ресурсы превращаются в структуру данных и коллекцию методов работы с ней - Spring Data JDBC агрегат сущность и Spring Data JDBC репозиторий, событие и Spring Application publisher, REST API модель и клиент и т.п.</p></section><section class="doc-section level-1"><h2 id=_примеры>Примеры</h2><p>Диаграмма эффектов микросервиса генерации фида с информацией об организации для яндекс карт и два гиса (картинка кликабельна):</p><div class=image-block><a class="image bare" href=/drafts/aggregates/images/effects-diagram-example-1.svg title="Open the image in full size" aria-label="Open the image in full size"><img src=/drafts/aggregates/images/effects-diagram-example-1.svg alt="effects diagram example 1"></a></div></section><section class="doc-section level-1"><h2 id=_алгоритм_построения>Алгоритм построения</h2></section><section class="doc-section level-1"><h2 id=_применение>Применение</h2><p>Я разработал и сейчас применяю диаграмму эффектов как основной инструмент декомпозиции системы на модули.
На первом этапе я переношу сущности ER-диаграммы на диаграмму эффектов в качестве ресурсов.
Затем информацию о том, какие сущности модифицируются какими операциями я использую как один из параметров процесса проектирования агрегатов - сущности которые всегда модифицируются вместе являются кандидатом на агрегат, операции, которые меняют сущности входящие в разные агрегаты являются кандидатом на перепроектирование.</p><p>Получив диаграмму эффектов с агрегатами в качестве ресурсов, я строю декомпозицию системы на модули таким образом, чтобы:</p><div class="olist arabic"><ol class=arabic><li>Операции, изменяющие ресурс и сам ресурс были в одном модуле</li><li>Операции обращались только к ресурсам из того же модуля</li></ol></div><p>100%-ое достижение этих свойств редко возможно, поэтому я допускаю их нарушение, если это делает дизайн более "разумным" на мой субъективный взгляд.</p></section><section class="doc-section level-1"><h2 id=_заключение>Заключение</h2></section></article></section></div></main><script src=/js/app.js></script></body></html>